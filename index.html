<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" type="image/x-icon"
	href="https://production-assets.codepen.io/assets/favicon/favicon-8ea04875e70c4b0bb41da869e81236e54394d63638a1ef12fa558a4a835f1164.ico" />
	<title>IDN Hierarchy Chart </title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /> -->
	<link rel='stylesheet prefetch'
	href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css'>
	<link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Roboto'>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script
	src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
	crossorigin="anonymous"></script>
	<script src="d3-context-menu.js"></script>
	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">

	<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js"></script>
</head>

<body translate="no">
    <div class="top-bar" id="navbar">
    	<div class="ui segment three column grid ui aligned inverted segment orange-bar" style="border-radius: 0em;" id= "filter-bar">
    		<div style="margin-top: 8px;">
    			<h3 style="font-size: 20px;">Customer Network Visualization</h3>
    		</div>
            <div class="dropdown-box">
            	<div class="ui fluid search selection dropdown entity_name" style="max-height: 35px;">
            		<input type="hidden" name="country">
            		<i class="dropdown icon"></i>
            		<div class="default text" id="selectedEntity" style="width: 100%; white-space: nowrap; overflow: hidden; text-overflow: clip;">Select IDN</div>
            		<div class="menu" id="entityNameMenu">
            		</div>
            	</div>
            </div>
            <div class="dropdown-box3">
            	<div class="ui fluid search selection dropdown entity_type" style="width: 150px; max-height: 35px;">
            		<input type="hidden" name="country">
            		<i class="dropdown icon"></i>
            		<div class="default text" id="selectedType" style="width: 100%; white-space: nowrap; overflow: hidden; text-overflow: clip;">Entity Types</div>
            		<div class="menu">
            		</div>
            	</div>
            </div>
            <div class="dropdown-box4">
            	<div class="ui fluid search selection dropdown view_color" style="width: 200px; max-height: 35px;">
            		<input type="hidden" name="country">
            		<i class="dropdown icon"></i>
            		<div class="default text" id="selectedColorBy" style="width: 100%; white-space: nowrap; overflow: hidden; text-overflow: clip;">View colors by</div>
            		<div class="menu">
            		</div>
            	</div>
            </div>

        </div>
    </div>
    <button class="btn-action btn-search" onclick="params.funcs.search()">
    	<i class="search icon" style="color: white;"></i>
    	Search
    </button>

    <button class="btn-tableau" onclick="params.funcs.renderTableau()" hidden>
    	Show Tableau
    </button>

    <div class="department-information">
    	<div class="dept-name">
    		dept name
    	</div>
    	<div class="dept-emp-count">
    		dept description test, this is department description
    	</div>
    	<div class="dept-description">
    		dept description test, this is department description
    	</div>
    </div>
    <div class="user-search-box" style="z-index: 100">
    	<div class="input-box">
    		<div class="close-button-wrapper" style="float: right;"><i onclick="params.funcs.closeSearchBox()" class="fa fa-times"
    			aria-hidden="true"></i></div>
    			<div class="input-wrapper">
    				<input type="text" class="search-input" style="white-space: nowrap;" placeholder="Search by account name" />
    				<!--<div class="input-bottom-placeholder">By Account Name</div>-->
    			</div>
    		</div>
    		<div class="result-box"  id="searchbar">
    			<div class="result-header" id="searchResultCount"> RESULTS </div>
    			<div class="result-list">
    				<div class="buffer"></div>
    			</div>
    		</div>
    	</div>
    	<div class="ui modal" id="RenameNodeModal">
    		<i class="close icon"></i>
    		<div class="header">
    			Rename a node
    		</div>
    		<div class="content">
    			<div class="description">
    				<div class="ui header">Rename Modal</div>
    				<div class="ui input">
    					<input type="text" id="RenameNodeName" placeholder="New ENTITY_NAME">
    				</div>
    			</div>
    		</div>
    		<div class="actions">
    			<div class="ui black deny button" onclick="params.funcs.close_rename_node_modal()">
    				No
    			</div>
    			<div class="ui positive right labeled icon button" onclick="params.funcs.rename_node()">
    				Yes, Rename Node
    				<i class="checkmark icon"></i>
    			</div>
    		</div>
    	</div>

    	<div class="ui tiny modal" id="CreateNodeModal">
    		<i class="close icon"></i>
    		<div class="header">
    			Create a child node
    		</div>
    		<div class="content">
    			<div class="description">
    				<div class="ui header">Create a child Node</div>
    				<div class="ui input">
    					<input type="text" id="createChildName" placeholder="Give a new name">
    				</div>
    			</div>

    		</div>
    		<div class="actions">
    			<div class="ui black deny button" onclick="params.funcs.close_rename_node_modal()">
    				No
    			</div>
    			<div class="ui positive right labeled icon button" onclick="params.funcs.create_node()">
    				Yes, create node
    				<i class="checkmark icon"></i>
    			</div>
    		</div>
		</div>

    	<div  class=" legend1">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: slateGray ;"></div>
    				</div>
    				<div class="content">
    					Filled
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend2">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: blue;"></div>
    				</div>

    				<div class="content">
    					Owned
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend3">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: magenta;"></div>
    				</div>
    				<div class="content">
    					Affiliated
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend4">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: red;"></div>
    				</div>
    				<div class="content">
    					Managed
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend5">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: orange;"></div>
    				</div>
    				<div class="content">
    					Leased
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend6">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: purple ;"></div>
    				</div>
    				<div class="content">
    					Ownership
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend7">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: forestgreen;"></div>
    				</div>
    				<div class="content">
    					Department
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class="legend8">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: black;"></div>
    				</div>
    				<div class="content">
    					Outlet
    				</div>
    			</div>
    		</div>
    	</div>
    </div>

	    <div class="legendB1">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box-b" id="lowCategory" style="background-color: black;"></div>
    				</div>
    				<div class="content">
    					Low
    				</div>
    			</div>
    		</div>
    	</div>
    </div>

	    <div class="legendB2">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box-b" id="mediumCategory" style="background-color: black;"></div>
    				</div>
    				<div class="content">
    					Medium
    				</div>
    			</div>
    		</div>
    	</div>
    </div>

	    <div class="legendB3">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box-b" id="highCategory" style="background-color: black;"></div>
    				</div>
    				<div class="content">
    					High
    				</div>
    			</div>
    		</div>
    	</div>
    </div>

    <div class="details-side-bar" id="detailsSideBar" style="border: 2px solid teal">
	
    </div>
    <div id="svgChart" style="float: right;">

    </div>

	<button id="fitToScreenButton" type="button" style="position: absolute;" onclick="params.funcs.fitToScreen()" class="svg-button"><i class="fa fa-arrows"></i></button>
	<button id="expandAllButton" type="button" style="position: absolute;" onclick="params.funcs.expandAll()" class="svg-button"><i class="fa fa-plus-square"></i></button>
	<button id="collapseAllButton" type="button" style="position: absolute;" onclick="params.funcs.collapseAll()" class="svg-button"><i class="fa fa-minus-square"></i></button>
	
    <script type="text/javascript" src="script-v2.js"></script>
    <script>
		window.onresize = function(){ location.reload(); }
    	var params = {
    		selector: "#svgChart",
    		dataLoadUrl: "https://gist.githubusercontent.com/venky18/3854ea4a96a4b249fc604443c81952a8/raw/f1a78e315491a6bac2065ec3b7382808b0d0ef26/random.json",
    		chartWidth: (window.innerWidth - 40) * 0.83,
    		chartHeight: window.innerHeight - 110,
    		funcs: {
    			showMySelf: null,
    			search: null,
    			closeSearchBox: null,
    			clearResult: null,
    			findInTree: null,
    			reflectResults: null,
    			departmentClick: null,
    			back: null,
    			toggleFullScreen: null,
    			locate: null,
    			download: null,
				collapseAll: null
    		},
			entityType: '',
    		data: null,
			colorCategory: {
				'low': '#F5B7B1',
				'medium': '#F9E79F',
				'high': '#A8FFD8'
			}
		}
		
		console.log('Width: ' + window.innerWidth)

		d3.select('#lowCategory').style('background-color', params.colorCategory.low)
		d3.select('#mediumCategory').style('background-color', params.colorCategory.medium)
		d3.select('#highCategory').style('background-color', params.colorCategory.high)

		d3.select('.legendB1').style('display', 'none')
		d3.select('.legendB2').style('display', 'none')
		d3.select('.legendB3').style('display', 'none')

		var selectedEntity = 0;
		var selected_org_type = 0;
		var selected_view_color = 0;

		d3.select('#fitToScreenButton').style('top', "70px")
		d3.select('#fitToScreenButton').style('left', (window.innerWidth - 100) + "px")

		d3.select('#expandAllButton').style('top', "100px")
		d3.select('#expandAllButton').style('left', (window.innerWidth - 100) + "px")

		d3.select('#collapseAllButton').style('top', "130px")
		d3.select('#collapseAllButton').style('left', (window.innerWidth - 100) + "px")

		var detailsSideBarWidth = (window.innerWidth - params.chartWidth - 3) < 300 ? (window.innerWidth - params.chartWidth - 3) : 300;
		params.chartWidth = window.innerWidth - detailsSideBarWidth - 3;
		var navbarHeight = parseInt(d3.select('#navbar').style("height").slice(0, -2))

		params.detailsSideBarWidth = detailsSideBarWidth;
		
		d3.select('.details-side-bar').style('width', detailsSideBarWidth + "px")
    	d3.select('.details-side-bar').style('height', (window.innerHeight - navbarHeight) + "px")

		console.log('Side bar: : ' + detailsSideBarWidth)
		
    	d3.select('.details-side-bar').style('top', (navbarHeight) + "px")
    	d3.select('.details-side-bar').style('position', "fixed")
    	d3.select('#svgChart').style('margin-left', detailsSideBarWidth + "px")
    	d3.select('#svgChart').style('top', "0px")

    	d3.select('.legend1').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend2').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend3').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend4').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend5').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend6').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend7').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend8').style('top', (window.innerHeight - 30) + "px")

    	d3.select('.legend1').style('left', (detailsSideBarWidth + 10) + "px")
    	d3.select('.legend2').style('left', (detailsSideBarWidth + 100) + "px")
    	d3.select('.legend3').style('left', (detailsSideBarWidth + 200) + "px")
    	d3.select('.legend4').style('left', (detailsSideBarWidth + 310) + "px")
    	d3.select('.legend5').style('left', (detailsSideBarWidth + 420) + "px")
    	d3.select('.legend6').style('left', (detailsSideBarWidth + 520) + "px")
    	d3.select('.legend7').style('left', (detailsSideBarWidth + 650) + "px")
    	d3.select('.legend8').style('left', (detailsSideBarWidth + 775) + "px")

    	d3.select('.legendB1').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legendB2').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legendB3').style('top', (window.innerHeight - 30) + "px")
		d3.select('.legendB1').style('left', (detailsSideBarWidth + 950) + "px")
    	d3.select('.legendB2').style('left', (detailsSideBarWidth + 1020) + "px")
    	d3.select('.legendB3').style('left', (detailsSideBarWidth + 1120) + "px")
		//d3.select('#fitToScreenButton').style('left', (detailsSideBarWidth + 25) + "px")

    	function toTitleCase(str) {
    		return str.replace(/(?:^|\s)\w/g, function(match) {
    			return match.toUpperCase();
    		});
    	}

		document.getElementById('selectedType').innerHTML = 'All';
		document.getElementById('selectedColorBy').innerHTML = 'None';

    	var OrgTypes = ['All', 'HOSP','CLIN', 'PHAR', 'INDP', 'WHOL', 'UNSPEC', 'CLIN', 'RC', 'PAYR', 'INDP', 'PHAR', 'HMHLT','OUTLET']
		var ViewColorByCategory = ['None', 'Patient Revenue', '	Net Income', 'Net Income Margin', 'Structure Segment', 'Patient Experience Segment', 'Quality Segment', 'Research Segment', 'Willingness to Partner Segment', 'Expression Segment']

    	d3.json("HES_V1_V5_HIERARCHY.json", function (error, data) {
    		if (error) {
    			return console.warn(error);
    		}
    		$('.ui.fluid.search.selection.dropdown.entity_name').dropdown({
    			fullTextSearch: true,
    			onChange: function (value, text, $selectedItem) {
    				console.log('value is ' + value)
					selectedEntity = value;
					document.getElementById('selectedType').innerHTML = 'All';

					d3.select('.legendB1').style('display', 'none')
					d3.select('.legendB2').style('display', 'none')
					d3.select('.legendB3').style('display', 'none')
					document.getElementById('selectedColorBy').innerHTML = 'None';
    					treeWrapper(value, 'All', 0);
    			}
    		});
    		$('.ui.fluid.search.selection.dropdown.entity_type').dropdown({
    			fullTextSearch: true,
    			onChange: function (value, text, $selectedItem) {
    				console.log('value is ' + text)
					selected_org_type = text;
					document.getElementById('selectedColorBy').innerHTML = 'None';

					d3.select('.legendB1').style('display', 'none')
					d3.select('.legendB2').style('display', 'none')
					d3.select('.legendB3').style('display', 'none')
    				treeWrapper(selectedEntity, text, 0);
    			}
    		});

			$('.ui.fluid.search.selection.dropdown.view_color').dropdown({
    			fullTextSearch: true,
    			onChange: function (value, text, $selectedItem) {
    				console.log('color is ' + value)
					selected_view_color = value;

					if (value == 0) {
						d3.select('.legendB1').style('display', 'none')
						d3.select('.legendB2').style('display', 'none')
						d3.select('.legendB3').style('display', 'none')
					}
					else {
						d3.select('.legendB1').style('display', 'block')
						d3.select('.legendB2').style('display', 'block')
						d3.select('.legendB3').style('display', 'block')
					}
    				
					treeWrapper(selectedEntity, selected_org_type, value);
    			}
    		});

            
            for (var i = 0; i < data.length; i++) {
                $('.dropdown.entity_name .menu')
                .append('<div class="item" data-value=' + i + '> ' + toTitleCase(data[i].ENTITY_NAME.toLowerCase()) + '</div>');
            }
            $('.ui.fluid.search.selection.dropdown.entity_name').dropdown("refresh")
            $('.ui.fluid.search.selection.dropdown.entity_name').dropdown('set selected', 0);
            
            for (var i = 0; i < OrgTypes.length; i++) {
                // console.log(data[i])
                $('.dropdown.entity_type .menu')
                .append('<div class="item" data-value=' + i + '> ' + OrgTypes[i] + '</div>');
            }
            $('.ui.fluid.search.selection.dropdown.entity_type').dropdown("refresh")
            $('.ui.fluid.search.selection.dropdown.entity_type').dropdown('set selected', 0);


            for (var i = 0; i < ViewColorByCategory.length; i++) {
                $('.dropdown.view_color .menu')
                .append('<div class="item" data-value=' + i + '> ' + ViewColorByCategory[i] + '</div>');
            }
            $('.ui.fluid.search.selection.dropdown.view_color').dropdown("refresh")
            $('.ui.fluid.search.selection.dropdown.view_color').dropdown('set selected', 0);

            function treeWrapper(entity_name,entity_type, color_by) {
            	d3.selectAll("svg").remove();
				console.log('Name: ' + entity_name)
                // debugger;
                var tempData = data[entity_name];
				params.data = tempData;
				params.dataIndex = entity_name;
				params.entityType = entity_type;
				params.colorBy = color_by;
				console.log('color: : ' + color_by)
				drawOrganizationChart(params);
            }

            var entityCount = d3.select("#entityNameMenu").selectAll('div')[0].length;
            var children = d3.select("#entityNameMenu").selectAll('div')[0];

            for (var i=0; i<entityCount; i+=1) {
            	if (children[i].textContent.toLowerCase().includes('Providence Saint Joseph Health'.toLowerCase())) {
					document.getElementById('selectedEntity').innerHTML = 'Providence Saint Joseph Health';
					selected_org_type = 'All';
					selected_view_color = 0;
					treeWrapper(i,'All', 0);
					selectedEntity = i;
            		d3.select('#selectedEntity').text(children[i].textContent);
            			break;
            	}
            }

            //treeWrapper(0,'All');
		})
    </script>
</body>

</html>