<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" type="image/x-icon"
	href="https://production-assets.codepen.io/assets/favicon/favicon-8ea04875e70c4b0bb41da869e81236e54394d63638a1ef12fa558a4a835f1164.ico" />
	<title>IDN Hierarchy Chart </title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /> -->
	<link rel='stylesheet prefetch'
	href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css'>
	<link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Roboto'>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script
	src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
	crossorigin="anonymous"></script>
	<script src="d3-context-menu.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
	<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js"></script>
</head>

<body translate="no">

    <!-- <div class="dropdown-box">
        <div class="ui fluid search selection dropdown">
            <input type="hidden" name="country">
            <i class="dropdown icon"></i>
            <div class="default text">Select IDN</div>
            <div class="menu">
            </div>
        </div>
    </div> -->
    <div class="top-bar" id="navbar">
    	<div class="ui segment three column grid ui aligned inverted segment orange-bar" style="border-radius: 0em;" id= "filter-bar">
    		<div style="margin-top: 8px;">
    			<h3>Customer Network Visualization</h3>
    		</div>
            <!-- <div class="dropdown-box">
                <div class="ui fluid search selection dropdown entity_name">
                    <input type="hidden" name="country">
                    <i class="dropdown icon"></i>
                    <div class="default text">Select IDN</div>
                    <div class="menu">
                    </div>
                </div>
            </div> -->
            <div class="dropdown-box">
            	<div class="ui fluid search selection dropdown entity_name">
            		<input type="hidden" name="country">
            		<i class="dropdown icon"></i>
            		<div class="default text" id="selectedEntity">Select IDN</div>
            		<div class="menu" id="entityNameMenu">
            		</div>
            	</div>
            </div>
            <div class="dropdown-box3">
            	<div class="ui fluid search multiple selection dropdown entity_type" style="width: 150px;">
            		<input type="hidden" name="country">
            		<i class="dropdown icon"></i>
            		<div class="default text">Entity Types</div>
            		<div class="menu">
            		</div>
            	</div>
            </div>
            <div class="dropdown-box4">
            	<div class="ui fluid search selection dropdown">
            		<input type="hidden" name="country">
            		<i class="dropdown icon"></i>
            		<div class="default text">View colors by</div>
            		<div class="menu">
            		</div>
            	</div>
            </div>

        </div>
    </div>
    <button class="btn-action btn-search" onclick="params.funcs.search()">
    	<i class="search icon" style="color: white;"></i>
    	Search
    </button>
    <div class="department-information">
    	<div class="dept-name">
    		dept name
    	</div>
    	<div class="dept-emp-count">
    		dept description test, this is department description
    	</div>
    	<div class="dept-description">
    		dept description test, this is department description
    	</div>
    </div>
    <div class="user-search-box" style="z-index: 100">
    	<div class="input-box">
    		<div class="close-button-wrapper" style="float: right;"><i onclick="params.funcs.closeSearchBox()" class="fa fa-times"
    			aria-hidden="true"></i></div>

    			<div class="input-wrapper">
    				<input type="text" class="search-input" style="white-space: nowrap;" placeholder="Search by account name" />
    				<!--<div class="input-bottom-placeholder">By Account Name</div>-->
    			</div>
    		</div>
    		<div class="result-box">
    			<div class="result-header"> RESULTS </div>
    			<div class="result-list">
    				<div class="buffer"></div>
    			</div>
    		</div>
    	</div>
    	<div class="ui modal" id="RenameNodeModal">
    		<i class="close icon"></i>
    		<div class="header">
    			Rename a node
    		</div>
    		<div class="content">
    			<div class="description">
    				<div class="ui header">Rename Modal</div>
    				<div class="ui input">
    					<input type="text" id="RenameNodeName" placeholder="New ENTITY_NAME">
    				</div>
    			</div>
    		</div>
    		<div class="actions">
    			<div class="ui black deny button" onclick="params.funcs.close_rename_node_modal()">
    				No
    			</div>
    			<div class="ui positive right labeled icon button" onclick="params.funcs.rename_node()">
    				Yes, Rename Node
    				<i class="checkmark icon"></i>
    			</div>
    		</div>
    	</div>

    	<div class="ui tiny modal" id="CreateNodeModal">
    		<i class="close icon"></i>
    		<div class="header">
    			Create a child node
    		</div>
    		<div class="content">
    			<div class="description">
    				<div class="ui header">Create a child Node</div>
    				<div class="ui input">
    					<input type="text" id="createChildName" placeholder="Give a new name">
    				</div>
    			</div>

    		</div>
    		<div class="actions">
    			<div class="ui black deny button" onclick="params.funcs.close_rename_node_modal()">
    				No
    			</div>
    			<div class="ui positive right labeled icon button" onclick="params.funcs.create_node()">
    				Yes, create node
    				<i class="checkmark icon"></i>
    			</div>
    		</div>
    	</div>

    	<div class="legend1">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: slateGray ;"></div>
    				</div>
    				<div class="content">
    					Filled
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend2">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: blue;"></div>
    				</div>

    				<div class="content">
    					Owned
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend3">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: magenta;"></div>
    				</div>
    				<div class="content">
    					Affiliated
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend4">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: red;"></div>
    				</div>
    				<div class="content">
    					Managed
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend5">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: orange;"></div>
    				</div>
    				<div class="content">
    					Leased
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend6">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: purple ;"></div>
    				</div>
    				<div class="content">
    					Ownership
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class=" legend7">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: forestgreen;"></div>
    				</div>
    				<div class="content">
    					Department
    				</div>
    			</div>
    		</div>
    	</div>

    	<div class="legend8">
    		<div class="ui middle aligned  list">
    			<div class="item">
    				<div class="input-color">
    					<div class="color-box" style="background-color: black;"></div>
    				</div>
    				<div class="content">
    					Outlet
    				</div>
    			</div>
    		</div>
    	</div>
    </div>


    <div class="details-side-bar" id="detailsSideBar">
    </div>

    <div id="svgChart" style="float: right;">

    </div>
    <script type="text/javascript" src="script-v2.js"></script>
    <script>
    	var params = {
    		selector: "#svgChart",
    		dataLoadUrl: "https://gist.githubusercontent.com/venky18/3854ea4a96a4b249fc604443c81952a8/raw/f1a78e315491a6bac2065ec3b7382808b0d0ef26/random.json",
    		chartWidth: (window.innerWidth - 40) * 0.83,
    		chartHeight: window.innerHeight - 110,
    		funcs: {
    			showMySelf: null,
    			search: null,
    			closeSearchBox: null,
    			clearResult: null,
    			findInTree: null,
    			reflectResults: null,
    			departmentClick: null,
    			back: null,
    			toggleFullScreen: null,
    			locate: null,
    			download: null
    		},
    		data: null
    	}


    	var detailsSideBarWidth = (window.innerWidth - params.chartWidth - 5)
    	d3.select('.details-side-bar').style('width', detailsSideBarWidth + "px")
    	d3.select('.details-side-bar').style('height', (params.chartHeight + 45) + "px")

    	var navbarHeight = parseInt(d3.select('#navbar').style("height").slice(0, -2))

    	d3.select('.details-side-bar').style('top', (navbarHeight + 2) + "px")
    	d3.select('.details-side-bar').style('position', "fixed")
    	//d3.select('#svgChart').style('margin-left', detailsSideBarWidth + "px")
    	d3.select('#svgChart').style('top', "0px")

    	d3.select('.legend1').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend2').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend3').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend4').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend5').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend6').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend7').style('top', (window.innerHeight - 30) + "px")
    	d3.select('.legend8').style('top', (window.innerHeight - 30) + "px")

    	d3.select('.legend1').style('left', (detailsSideBarWidth + 25) + "px")
    	d3.select('.legend2').style('left', (detailsSideBarWidth + 150) + "px")
    	d3.select('.legend3').style('left', (detailsSideBarWidth + 275) + "px")
    	d3.select('.legend4').style('left', (detailsSideBarWidth + 400) + "px")
    	d3.select('.legend5').style('left', (detailsSideBarWidth + 525) + "px")
    	d3.select('.legend6').style('left', (detailsSideBarWidth + 650) + "px")
    	d3.select('.legend7').style('left', (detailsSideBarWidth + 775) + "px")
    	d3.select('.legend8').style('left', (detailsSideBarWidth + 900) + "px")

    	function toTitleCase(str) {
    		return str.replace(/(?:^|\s)\w/g, function(match) {
    			return match.toUpperCase();
    		});
    	}

    	var OrgTypes = ['All', 'HOSP','CLIN', 'PHAR', 'INDP', 'WHOL', 'UNSPEC', 'CLIN', 'RC', 'PAYR', 'INDP', 'PHAR', 'HMHLT','OUTLET']

    	d3.json("HES_V1_V5_HIERARCHY.json", function (error, data) {
    		if (error) {
    			return console.warn(error);
    		}
    		$('.ui.fluid.search.selection.dropdown.entity_name').dropdown({
    			fullTextSearch: true,
    			onChange: function (value, text, $selectedItem) {
    				console.log('value is ' + value)
    					treeWrapper(value,'All');
    			}
    		});
    		$('.ui.fluid.search.selection.dropdown.entity_type').dropdown({
    			fullTextSearch: true,
    			onChange: function (value, text, $selectedItem) {
    				console.log('value is ' + value)
    				treeWrapper(value);
    			}
    		});

            // console.log('data starts')
            // console.log(data)
            
            for (var i = 0; i < data.length; i++) {
                // console.log(data[i])
                $('.dropdown.entity_name .menu')
                .append('<div class="item" data-value=' + i + '> ' + toTitleCase(data[i].ENTITY_NAME.toLowerCase()) + '</div>');
            }
            $('.ui.fluid.search.selection.dropdown.entity_name').dropdown("refresh")
            $('.ui.fluid.search.selection.dropdown.entity_name').dropdown('set selected', 0);
            
            for (var i = 0; i < OrgTypes.length; i++) {
                // console.log(data[i])
                $('.dropdown.entity_type .menu')
                .append('<div class="item" data-value=' + i + '> ' + OrgTypes[i] + '</div>');
            }

            $('.ui.fluid.search.selection.dropdown.entity_type').dropdown("refresh")
            $('.ui.fluid.search.selection.dropdown.entity_type').dropdown('set selected', 0);
            function treeWrapper(entity_name,entity_type) {
            	d3.selectAll("svg").remove();
                // debugger;
                var tempData = data[entity_name];
                if(entity_type == 'All') {   
                	params.data = tempData;
                    // params.pristinaData = JSON.parse(JSON.stringify(tempData));
                    drawOrganizationChart(params);
                }       
                else{
                    // debugger;
                    // entity_type.push ('IDN','IDN_Filled','OSUB','OSUB_Filled','HOSP_Filled','HOSP')
                    params.data = tempData;
                    // params.pristinaData = JSON.parse(JSON.stringify(tempData));
                    drawOrganizationChart(params);

                }
            }

            var entityCount = d3.select("#entityNameMenu").selectAll('div')[0].length;
            var children = d3.select("#entityNameMenu").selectAll('div')[0];

            for (var i=0; i<entityCount; i+=1) {
            	if (children[i].textContent.toLowerCase().includes('Providence Saint Joseph Health'.toLowerCase())) {
            		treeWrapper(i,'All');
            		d3.select('#selectedEntity').text(children[i].textContent);
            			break;
            	}
            }

            //treeWrapper(0,'All');
        })
    </script>
</body>

</html>